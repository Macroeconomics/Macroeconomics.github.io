<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Faster Dynamic Programming with Numba - Macroeconomics II (Econ-6395)</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://macroeconomics.github.io/images/favicomatic/favicon.ico" rel="icon">

<link rel="canonical" href="https://macroeconomics.github.io/Dynamic Programming Numba.html">

        <meta name="author" content="Ömer Özak" />
        <meta name="keywords" content="Macroeconomics,IPython,Notebooks" />
        <meta name="description" content="Faster Computations with Numba¶ Some notes mostly for myself, but could be useful to you¶ Altough Python is fast compared to other high-level languages, it still is not as fast as C, C++ or Fortran. Luckily, two open source projects Numba and Cython can be used to speed-up computations. Numba is sponsored by the producer of Anaconda" />

        <meta property="og:site_name" content="Macroeconomics II (Econ-6395)" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Faster Dynamic Programming with Numba"/>
        <meta property="og:url" content="https://macroeconomics.github.io/Dynamic Programming Numba.html"/>
        <meta property="og:description" content="Faster Computations with Numba¶ Some notes mostly for myself, but could be useful to you¶ Altough Python is fast compared to other high-level languages, it still is not as fast as C, C++ or Fortran. Luckily, two open source projects Numba and Cython can be used to speed-up computations. Numba is sponsored by the producer of Anaconda"/>
        <meta property="article:published_time" content="2016-12-29" />
            <meta property="article:section" content="Ph.D." />
            <meta property="article:tag" content="Macroeconomics" />
            <meta property="article:tag" content="IPython" />
            <meta property="article:tag" content="Notebooks" />
            <meta property="article:author" content="Ömer Özak" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://macroeconomics.github.io/theme/css/bootstrap.slate.min.css" type="text/css"/>
    <link href="https://macroeconomics.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://macroeconomics.github.io/theme/css/pygments/default.css" rel="stylesheet">
    <link rel="stylesheet" href="https://macroeconomics.github.io/theme/css/style.css" type="text/css"/>
        <link href="https://macroeconomics.github.io/static/custom.css" rel="stylesheet">

        <link href="https://macroeconomics.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Macroeconomics II (Econ-6395) ATOM Feed"/>



        <link href="https://macroeconomics.github.io/feeds/phd.atom.xml" type="application/atom+xml" rel="alternate"
              title="Macroeconomics II (Econ-6395) Ph.D. ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://macroeconomics.github.io/" class="navbar-brand">
Macroeconomics II (Econ-6395)            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/pages/Syllabus.html">Syllabus</a></li>
                    <li><a href="/pages/Lecture Notes.html">Lecture Notes</a></li>
                    <li><a href="/pages/Practice Material.html">Practice Material</a></li>
                    <li><a href="/pages/Computation.html">Computation</a></li>
                    <li><a href="/pages/CV.html">CV</a></li>
                    <li><a href="/pages/Contact.html">Contact</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://macroeconomics.github.io/Dynamic Programming Numba.html"
                       rel="bookmark"
                       title="Permalink to Faster Dynamic Programming with Numba">
                        Faster Dynamic Programming with Numba
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-12-29T10:20:00-06:00"> Thu 29 December 2016</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://macroeconomics.github.io/tag/macroeconomics.html">Macroeconomics</a>
        /
	<a href="https://macroeconomics.github.io/tag/ipython.html">IPython</a>
        /
	<a href="https://macroeconomics.github.io/tag/notebooks.html">Notebooks</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Faster-Computations-with-Numba">Faster Computations with Numba<a class="anchor-link" href="#Faster-Computations-with-Numba">¶</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Some-notes-mostly-for-myself,-but-could-be-useful-to-you">Some notes mostly for myself, but could be useful to you<a class="anchor-link" href="#Some-notes-mostly-for-myself,-but-could-be-useful-to-you">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Altough Python is fast compared to other high-level languages, it still is not as fast as C, C++ or Fortran. Luckily, two open source projects <a href="http://numba.pydata.org/">Numba</a> and <a href="http://cython.org/">Cython</a> can be used to speed-up computations. <a href="http://numba.pydata.org/">Numba</a> is sponsored by the producer of <a href="https://store.continuum.io/cshop/anaconda/">Anaconda</a>, <a href="http://continuum.io/">Continuum Analytics</a>. Both projects allow you to convert your code to interpreted language so that it runs faster. Here I will use Numba, given its ease and Just-In-Time nature, although I still have to figure out how to save and use the compiled functions (newer versions of <a href="http://numba.pydata.org/">Numba</a> seem to have introduced <a href="https://numba.pydata.org/numba-doc/dev/user/pycc.html">Ahead-of-Time</a> compilation using pycc and static libraries it seems.). Cython on the other hand needs you to understand much more of C and Ctypes. But once you figure out a way to run your code and compile it, you have a library ready to use and import. See the code for the repository for my paper <a href="http://ozak.github.io/BoundedConsumption/">Optimal consumption under uncertainty, liquidity constraints, and bounded rationality</a> where I used Cython for the dynsysf.pyx function.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Numba">Numba<a class="anchor-link" href="#Numba">¶</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Numba is quite easy to use. Start by importing it</p>
<pre><code>import numba as nb

</code></pre>
<p>or some of its functions</p>
<pre><code>from numba import jit, autojit, njit

</code></pre>
<p>Then define your function and notate it using the Numba commands jit, njit, autojit or their decorators @jit, @njit.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span><span class="p">,</span> <span class="n">njit</span><span class="p">,</span> <span class="n">autojit</span><span class="p">,</span> <span class="n">jitclass</span>
<span class="kn">import</span> <span class="nn">numba</span> <span class="k">as</span> <span class="nn">nb</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">,</span> <span class="n">nb</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">NumbaDeprecationWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Examples:">Examples:<a class="anchor-link" href="#Examples:">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># A simple function that computes the maximum distance between two vectors</span>
<span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8(f8[:],f8[:])'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">errnb</span><span class="p">(</span><span class="n">V0</span><span class="p">,</span><span class="n">V1</span><span class="p">):</span>
    <span class="n">maxi</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">V0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">V0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">>=</span><span class="n">maxi</span><span class="p">:</span>
            <span class="n">maxi</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">return</span> <span class="n">maxi</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">1000</span><span class="p">))</span>

<span class="o">%</span><span class="k">timeit</span> errnb(x,y)
<span class="o">%</span><span class="k">timeit</span> np.max(np.abs(x-y))
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>2.37 µs ± 231 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
6.19 µs ± 304 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Let's use Numba to compute a Cobb-Douglas function</span>
<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">CobbDouglas</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">K</span><span class="o">**</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="n">beta</span>

<span class="n">K</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span>

<span class="n">CobbDouglas</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[3]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>2.0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's time it and compare with Numpy or simple Python</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> A * K**alpha * L**beta
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>147 ns ± 2.49 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglas(K,L,A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>225 ns ± 12.3 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Well not fast enough...why?</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">CobbDouglas</span><span class="o">.</span><span class="n">inspect_types</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>CobbDouglas (int64, int64, int64, float64, float64)
--------------------------------------------------------------------------------
# File: <ipython-input-3-3e653c7a0b0c>
# --- LINE 2 --- 
# label 0

@jit

# --- LINE 3 --- 

def CobbDouglas(K, L, A, alpha, beta):

    # --- LINE 4 --- 
    #   K = arg(0, name=K)  :: int64
    #   L = arg(1, name=L)  :: int64
    #   A = arg(2, name=A)  :: int64
    #   alpha = arg(3, name=alpha)  :: float64
    #   beta = arg(4, name=beta)  :: float64
    #   $0.4 = K ** alpha  :: float64
    #   del alpha
    #   del K
    #   $0.5 = A * $0.4  :: float64
    #   del A
    #   del $0.4
    #   $0.8 = L ** beta  :: float64
    #   del beta
    #   del L
    #   $0.9 = $0.5 * $0.8  :: float64
    #   del $0.8
    #   del $0.5
    #   $0.10 = cast(value=$0.9)  :: float64
    #   del $0.9
    #   return $0.10

    return A * K**alpha * L**beta


================================================================================
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>OK...it is correctly compiled and it is using Numba types and not PyObjects. So perhaps we cannot gain much in this simple computation...but that is ok. Let's try something a little more complex, computing a CobbDouglas for vectors K and L</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Python function</span>
<span class="k">def</span> <span class="nf">CobbDouglas</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">K</span><span class="o">**</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="n">beta</span>

<span class="n">CobbDouglas_nb</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="n">CobbDouglas</span><span class="p">)</span>
<span class="n">CobbDouglas_nb2</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">CobbDouglas</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglas(K,L,A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>7.52 µs ± 575 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglas_nb(K,L,A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>4.7 µs ± 59.8 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglas_nb2(K,L,A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>5.94 µs ± 621 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ooops what went wrong? Up to V.0.12.2 Numba could not create arrays in <code>njit</code> mode, i.e. without using Python Objects. But things seem to have improved a lot since then. But even for the old days, we do not need to despair, we can create a fast CobbDouglas function by iterating over our vectors. Here I first create the <code>CobbDouglasNB</code> function which takes floating point numbers and tells Numba not to use PyObjects, and then I create the vectorized version <code>CobbDouglasVecNB</code>, which iterates over the elements of K and L (here we assume both are vectors) and returns our output Y. I know it is strange that we have to give the output as part of the function, but it allows us to speed up the computations.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="s1">'f8(f8, f8, f8, f8, f8)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">CobbDouglasNB</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">K</span><span class="o">**</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="n">beta</span>

<span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8[:](f8[:], f8[:], f8[:], f8, f8, f8)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">CobbDouglasVecNB</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">CobbDouglasNB</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">A</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Y</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">K</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[13]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>0.48966064683582006</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglas(K[:,0],L[:,0],A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>9.17 µs ± 1.26 µs per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> CobbDouglasVecNB(Y[:,0],K[:,0],L[:,0],A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>6.46 µs ± 157 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Almost-twice-as-fast-as-Numpy!">Almost twice as fast as Numpy!<a class="anchor-link" href="#Almost-twice-as-fast-as-Numpy!">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's generalize the function to arrays of 2 dimensions</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8[:,:](f8[:,:], f8[:,:], f8[:,:], f8, f8, f8)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">CobbDouglasVecNB</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">CobbDouglasNB</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Y</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">K</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">L</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">))</span>
<span class="o">%</span><span class="k">timeit</span> CobbDouglas(K,L,A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>48.9 ms ± 3.69 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> CobbDouglasVecNB(Y,K,L,A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>44 ms ± 573 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="20%-faster-than-Numpy...so-we-get-the-idea.">20% faster than Numpy...so we get the idea.<a class="anchor-link" href="#20%-faster-than-Numpy...so-we-get-the-idea.">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>While this is great to speed up, we see that there are some issues one has to think about in order to get those gains.</p>
<p>Now let's use the vectorize option, which creates Numpy Ufunctions, that is functions that operate on vectors (or at leats that s what I gather).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@nb</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="s1">'f8(f8, f8, f8, f8, f8,)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">CobbDouglasNB2</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">K</span><span class="o">**</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="n">beta</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglasNB2(K,L,A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>45.4 ms ± 741 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's compare these functions on different sizes of matrices $K$ and $L$</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglas(K[1:100,1:100],L[1:100,1:100],A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>478 µs ± 18.7 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglasVecNB(Y[1:100,1:100],K[1:100,1:100],L[1:100,1:100],A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>450 µs ± 9.08 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglasNB2(K[1:100,1:100],L[1:100,1:100],A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>428 µs ± 40.6 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglas(K[1:1000,1:1000],L[1:1000,1:1000],A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>40.4 ms ± 2.11 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglasVecNB(Y[1:1000,1:1000],K[1:1000,1:1000],L[1:1000,1:1000],A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>37.1 ms ± 2.33 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglasNB2(K[1:1000,1:1000],L[1:1000,1:1000],A,alpha,beta)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>39 ms ± 2.81 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now let's try the CRRA utility function</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8(f8, f8)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">U_numba</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">'''This function returns the value of utility when the CRRA</span>
<span class="sd">    coefficient is sigma. I.e. </span>
<span class="sd">    u(c,sigma)=(c**(1-sigma)-1)/(1-sigma) if sigma!=1 </span>
<span class="sd">    and </span>
<span class="sd">    u(c,sigma)=ln(c) if sigma==1</span>
<span class="sd">    Usage: u(c,sigma)</span>
<span class="sd">    '''</span>
    <span class="k">if</span> <span class="n">sigma</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8[:](f8[:], f8[:], f8)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">Uvec</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sigma</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">U_numba</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Unp</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sigma</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@nb</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="s1">'f8(f8,f8)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">Unb</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sigma</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8[:](f8[:], f8)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">U</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sigma</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">Unb</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span><span class="c1">#(c**(1-sigma)-1)/(1-sigma)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Grid of values for state variable over which function will be approximated</span>
<span class="n">gridmin</span><span class="p">,</span> <span class="n">gridmax</span><span class="p">,</span> <span class="n">gridsize</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">300</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">gridmin</span><span class="p">,</span> <span class="n">gridmax</span><span class="o">**</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">)</span><span class="o">**</span><span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> U(grid,1)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>2.49 µs ± 113 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> Unp(grid,1)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>2.45 µs ± 63.4 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> Unb(grid,1)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>2.71 µs ± 152 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> Uvec(u, grid, 1)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>2.42 µs ± 181 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [38]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> U(grid,3)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>5.93 µs ± 327 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [39]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> Unb(grid,3)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>6.33 µs ± 58.4 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> Unp(grid,3)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>8.68 µs ± 43.4 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [41]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> Uvec(u,grid,3)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>5.73 µs ± 162 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Optimizing-the-code-for-Dynamic-Programming">Optimizing the code for Dynamic Programming<a class="anchor-link" href="#Optimizing-the-code-for-Dynamic-Programming">¶</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Optimal-Growth">Optimal Growth<a class="anchor-link" href="#Optimal-Growth">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Parameters Optimal Growth</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">3</span>
<span class="n">beta</span> <span class="o">=</span> <span class="o">.</span><span class="mi">9</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">A</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [43]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Grid of values for state variable over which function will be approximated</span>
<span class="n">gridmin</span><span class="p">,</span> <span class="n">gridmax</span><span class="p">,</span> <span class="n">gridsize</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">300</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">gridmin</span><span class="p">,</span> <span class="n">gridmax</span><span class="o">**</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">)</span><span class="o">**</span><span class="mi">10</span>

<span class="c1"># Parameters for the optimization procedures</span>
<span class="n">count</span><span class="o">=</span><span class="mi">0</span>
<span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'tol=</span><span class="si">%f</span><span class="s1">'</span> <span class="o">%</span> <span class="n">tol</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>tol=0.000001
(300,)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [44]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numba</span> <span class="k">as</span> <span class="nn">nb</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fminbound</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interp</span>

<span class="c1"># Auxiliary functions </span>
<span class="c1"># Maximize function V on interval [a,b]</span>
<span class="k">def</span> <span class="nf">maximum</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[]):</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">fminbound</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)))</span>

<span class="c1"># Return Maximizer of function V on interval [a,b]</span>
<span class="k">def</span> <span class="nf">maximizer</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[]):</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">fminbound</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">))</span>

<span class="c1"># Interpolation functions Class</span>
<span class="k">class</span> <span class="nc">LinInterp</span><span class="p">:</span>
    <span class="s2">"Provides linear interpolation in one dimension."</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
        <span class="sd">"""Parameters: X and Y are sequences or arrays</span>
<span class="sd">        containing the (x,y) interpolation points.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="sd">"""Parameters: z is a number, sequence or array.</span>
<span class="sd">        This method makes an instance f of LinInterp callable,</span>
<span class="sd">        so f(z) returns the interpolation value(s) at z.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">interp</span> <span class="p">([</span><span class="n">z</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">interp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [45]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8[:](f8[:], f8)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">U</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sigma</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">Unb</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span>

<span class="nd">@nb</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="s1">'f8(f8,f8)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">Unb</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sigma</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@nb</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="s1">'f8(f8, f8, f8, f8, f8,)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">CobbDouglasNB2</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="sd">'''CobbDouglasNB2(K, L, A, alpha, beta)'''</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">K</span><span class="o">**</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="n">beta</span>

<span class="nd">@nb</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="s1">'f8(f8, f8, f8)'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">F_nb</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Cobb-Douglas production function</span>
<span class="sd">    F(K)=A* K^alpha</span>
<span class="sd">    '''</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">K</span><span class="o">**</span><span class="n">alpha</span>

<span class="k">def</span> <span class="nf">F_np</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
    <span class="sd">'''</span>
<span class="sd">    Cobb-Douglas production function</span>
<span class="sd">    F(K)=A* K^alpha</span>
<span class="sd">    '''</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">K</span><span class="o">**</span><span class="n">alpha</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [47]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> CobbDouglasNB2(grid,1,A,alpha,0)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>9.68 µs ± 382 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> F_nb(grid,alpha,A)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>7.28 µs ± 357 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [49]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> F_np(grid,alpha,A)
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>7.6 µs ± 538 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [50]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">V0</span> <span class="o">=</span> <span class="n">LinInterp</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">sigma</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [51]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">bellman</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>
    <span class="sd">"""The approximate Bellman operator.</span>
<span class="sd">    Parameters: w is a LinInterp object (i.e., a </span>
<span class="sd">    callable object which acts pointwise on arrays).</span>
<span class="sd">    Returns: An instance of LinInterp that represents the optimal operator.</span>
<span class="sd">    w is a function defined on the state space.</span>
<span class="sd">    """</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">kmax</span><span class="o">=</span><span class="n">F_nb</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">kp</span><span class="p">:</span> <span class="n">U_numba</span><span class="p">(</span><span class="n">kmax</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">delta</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span> <span class="o">-</span> <span class="n">kp</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">w</span><span class="p">(</span><span class="n">kp</span><span class="p">)</span>
        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kmax</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">LinInterp</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [52]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">policy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    For each function w, policy(w) returns the function that maximizes the </span>
<span class="sd">    RHS of the Bellman operator.</span>
<span class="sd">    Replace w for the Value function to get optimal policy.</span>
<span class="sd">    The approximate optimal policy operator w-greedy (See Stachurski (2009)). </span>
<span class="sd">    Parameters: w is a LinInterp object (i.e., a </span>
<span class="sd">    callable object which acts pointwise on arrays).</span>
<span class="sd">    Returns: An instance of LinInterp that captures the optimal policy.</span>
<span class="sd">    """</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">kmax</span><span class="o">=</span><span class="n">F_nb</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">kp</span><span class="p">:</span> <span class="n">U_numba</span><span class="p">(</span><span class="n">kmax</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">delta</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span> <span class="o">-</span> <span class="n">kp</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">w</span><span class="p">(</span><span class="n">kp</span><span class="p">)</span>
        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maximizer</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kmax</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">LinInterp</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [53]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">solve</span><span class="p">():</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">V0</span><span class="o">=</span><span class="n">LinInterp</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">sigma</span><span class="p">))</span>
    <span class="k">while</span> <span class="n">count</span><span class="o"><</span><span class="n">maxiter</span><span class="p">:</span>
        <span class="n">V1</span> <span class="o">=</span> <span class="n">bellman</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">V0</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">V1</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">V0</span><span class="p">(</span><span class="n">grid</span><span class="p">))))</span>
        <span class="n">V0</span> <span class="o">=</span> <span class="n">V1</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">err</span><span class="o"><</span><span class="n">tol</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">V0</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [54]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">V0</span> <span class="o">=</span> <span class="n">bellman</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">V0</span><span class="p">)</span>
<span class="n">C0</span> <span class="o">=</span> <span class="n">policy</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">V0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [55]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> bellman(grid, V0)
<span class="o">%</span><span class="k">timeit</span> policy(grid ,V0)
<span class="o">%</span><span class="k">timeit</span> solve()
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>182 ms ± 7.02 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
193 ms ± 9.49 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
138
138
138
138
138
138
138
138
22.1 s ± 267 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [56]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Utrf</span><span class="p">(</span><span class="n">kp</span><span class="p">,</span><span class="n">kmax</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">U_numba</span><span class="p">(</span><span class="n">kmax</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">delta</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span> <span class="o">-</span> <span class="n">kp</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span><span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">w</span><span class="p">(</span><span class="n">kp</span><span class="p">)</span>

<span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8[:](f8[:], f8[:])'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bellmannb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w0</span><span class="p">):</span>
    <span class="sd">"""The approximate Bellman operator.</span>
<span class="sd">    Parameters: w is a LinInterp object (i.e., a </span>
<span class="sd">    callable object which acts pointwise on arrays).</span>
<span class="sd">    Returns: An instance of LinInterp that represents the optimal operator.</span>
<span class="sd">    w is a function defined on the state space.</span>
<span class="sd">    """</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">LinInterp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">kmax</span> <span class="o">=</span> <span class="n">F_nb</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="o">-</span><span class="n">Utrf</span><span class="p">(</span><span class="n">fminbound</span><span class="p">(</span><span class="n">Utrf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">kmax</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">w</span><span class="p">]),</span><span class="n">kmax</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">w</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">vals</span>

<span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8[:](f8[:],f8[:])'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">policynb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w0</span><span class="p">):</span>
    <span class="sd">"""The approximate Bellman operator.</span>
<span class="sd">    Parameters: w is a LinInterp object (i.e., a </span>
<span class="sd">    callable object which acts pointwise on arrays).</span>
<span class="sd">    Returns: An instance of LinInterp that represents the optimal operator.</span>
<span class="sd">    w is a function defined on the state space.</span>
<span class="sd">    """</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">LinInterp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">kmax</span> <span class="o">=</span> <span class="n">F_nb</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">fminbound</span><span class="p">(</span><span class="n">Utrf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">kmax</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">w</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">vals</span>

<span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8(f8[:],f8[:])'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">errnb</span><span class="p">(</span><span class="n">V0</span><span class="p">,</span><span class="n">V1</span><span class="p">):</span>
    <span class="n">maxi</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">V0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">m</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">V1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">V0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">>=</span><span class="n">maxi</span><span class="p">:</span>
            <span class="n">maxi</span><span class="o">=</span><span class="n">m</span>
    <span class="k">return</span> <span class="n">maxi</span>

<span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8[:]()'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">solvenb</span><span class="p">():</span>
    <span class="n">count</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">V0</span><span class="o">=</span><span class="n">U</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">count</span><span class="o"><</span><span class="n">maxiter</span><span class="p">:</span>
        <span class="n">V1</span><span class="o">=</span><span class="n">bellmannb</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">V0</span><span class="p">)</span>
        <span class="n">err</span><span class="o">=</span><span class="n">errnb</span><span class="p">(</span><span class="n">V1</span><span class="p">,</span><span class="n">V0</span><span class="p">)</span>
        <span class="n">V0</span><span class="o">=</span><span class="n">V1</span>
        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">err</span><span class="o"><</span><span class="n">tol</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">V0</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><ipython-input-56-b9b01bd2fa01>:4: NumbaWarning: 
Compilation is falling back to object mode WITH looplifting enabled because Function "bellmannb" failed type inference due to: Untyped global name 'LinInterp': cannot determine Numba type of <class &#x27;type&#x27;>

File "<ipython-input-56-b9b01bd2fa01>", line 12:
def bellmannb(x,w0):
    <source elided>
    """
    w = LinInterp(x,w0)
    ^

  @nb.jit('f8[:](f8[:], f8[:])')
<ipython-input-56-b9b01bd2fa01>:4: NumbaWarning: 
Compilation is falling back to object mode WITHOUT looplifting enabled because Function "bellmannb" failed type inference due to: Untyped global name 'LinInterp': cannot determine Numba type of <class &#x27;type&#x27;>

File "<ipython-input-56-b9b01bd2fa01>", line 12:
def bellmannb(x,w0):
    <source elided>
    """
    w = LinInterp(x,w0)
    ^

  @nb.jit('f8[:](f8[:], f8[:])')
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:742: NumbaWarning: Function "bellmannb" was compiled in object mode without forceobj=True, but has lifted loops.

File "<ipython-input-56-b9b01bd2fa01>", line 5:
@nb.jit('f8[:](f8[:], f8[:])')
def bellmannb(x,w0):
^

  self.func_ir.loc))
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:751: NumbaDeprecationWarning: 
Fall-back from the nopython compilation path to the object mode compilation path has been detected, this is deprecated behaviour.

For more information visit http://numba.pydata.org/numba-doc/latest/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit

File "<ipython-input-56-b9b01bd2fa01>", line 5:
@nb.jit('f8[:](f8[:], f8[:])')
def bellmannb(x,w0):
^

  warnings.warn(errors.NumbaDeprecationWarning(msg, self.func_ir.loc))
<ipython-input-56-b9b01bd2fa01>:19: NumbaWarning: 
Compilation is falling back to object mode WITH looplifting enabled because Function "policynb" failed type inference due to: Untyped global name 'LinInterp': cannot determine Numba type of <class &#x27;type&#x27;>

File "<ipython-input-56-b9b01bd2fa01>", line 27:
def policynb(x,w0):
    <source elided>
    """
    w = LinInterp(x,w0)
    ^

  @nb.jit('f8[:](f8[:],f8[:])')
<ipython-input-56-b9b01bd2fa01>:19: NumbaWarning: 
Compilation is falling back to object mode WITHOUT looplifting enabled because Function "policynb" failed type inference due to: Untyped global name 'LinInterp': cannot determine Numba type of <class &#x27;type&#x27;>

File "<ipython-input-56-b9b01bd2fa01>", line 27:
def policynb(x,w0):
    <source elided>
    """
    w = LinInterp(x,w0)
    ^

  @nb.jit('f8[:](f8[:],f8[:])')
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:742: NumbaWarning: Function "policynb" was compiled in object mode without forceobj=True, but has lifted loops.

File "<ipython-input-56-b9b01bd2fa01>", line 20:
@nb.jit('f8[:](f8[:],f8[:])')
def policynb(x,w0):
^

  self.func_ir.loc))
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:751: NumbaDeprecationWarning: 
Fall-back from the nopython compilation path to the object mode compilation path has been detected, this is deprecated behaviour.

For more information visit http://numba.pydata.org/numba-doc/latest/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit

File "<ipython-input-56-b9b01bd2fa01>", line 20:
@nb.jit('f8[:](f8[:],f8[:])')
def policynb(x,w0):
^

  warnings.warn(errors.NumbaDeprecationWarning(msg, self.func_ir.loc))
<ipython-input-56-b9b01bd2fa01>:43: NumbaWarning: 
Compilation is falling back to object mode WITH looplifting enabled because Function "solvenb" failed type inference due to: Invalid use of type(CPUDispatcher(<function u at 0x1b7876d08>)) with parameters (readonly array(float64, 1d, C), Literal[int](1))
Known signatures:
 * (array(float64, 1d, A), float64) -> array(float64, 1d, A)
 * parameterized
[1] During: resolving callee type: type(CPUDispatcher(<function u at 0x1b7876d08>))
[2] During: typing of call at <ipython-input-56-b9b01bd2fa01> (46)


File "<ipython-input-56-b9b01bd2fa01>", line 46:
def solvenb():
    <source elided>
    count=0.0
    V0=U(grid,sigma)
    ^

  @nb.jit('f8[:]()')
<ipython-input-56-b9b01bd2fa01>:43: NumbaWarning: 
Compilation is falling back to object mode WITHOUT looplifting enabled because Function "solvenb" failed type inference due to: cannot determine Numba type of <class &#x27;numba.dispatcher.liftedloop&#x27;>

File "<ipython-input-56-b9b01bd2fa01>", line 46:
def solvenb():
    <source elided>
    count=0.0
    V0=U(grid,sigma)
    ^

  @nb.jit('f8[:]()')
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:742: NumbaWarning: Function "solvenb" was compiled in object mode without forceobj=True, but has lifted loops.

File "<ipython-input-56-b9b01bd2fa01>", line 44:
@nb.jit('f8[:]()')
def solvenb():
^

  self.func_ir.loc))
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:751: NumbaDeprecationWarning: 
Fall-back from the nopython compilation path to the object mode compilation path has been detected, this is deprecated behaviour.

For more information visit http://numba.pydata.org/numba-doc/latest/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit

File "<ipython-input-56-b9b01bd2fa01>", line 44:
@nb.jit('f8[:]()')
def solvenb():
^

  warnings.warn(errors.NumbaDeprecationWarning(msg, self.func_ir.loc))
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [57]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">U0</span> <span class="o">=</span> <span class="n">U</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>

<span class="n">U0</span> <span class="o">=</span> <span class="n">bellmannb</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">U0</span><span class="p">)</span>

<span class="n">c0</span> <span class="o">=</span> <span class="n">policynb</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">U0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><ipython-input-56-b9b01bd2fa01>:4: NumbaWarning: 
Compilation is falling back to object mode WITHOUT looplifting enabled because Function "bellmannb" failed type inference due to: Untyped global name 'Utrf': cannot determine Numba type of <class &#x27;function&#x27;>

File "<ipython-input-56-b9b01bd2fa01>", line 16:
def bellmannb(x,w0):
    <source elided>
        kmax = F_nb(k,alpha,A)
        vals = np.append(vals, -Utrf(fminbound(Utrf, 0, kmax, args=[kmax,k,sigma,w]),kmax,k,sigma,w))
        ^

  @nb.jit('f8[:](f8[:], f8[:])')
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:742: NumbaWarning: Function "bellmannb" was compiled in object mode without forceobj=True.

File "<ipython-input-56-b9b01bd2fa01>", line 14:
def bellmannb(x,w0):
    <source elided>
    vals = np.array([])
    for k in x:
    ^

  self.func_ir.loc))
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:751: NumbaDeprecationWarning: 
Fall-back from the nopython compilation path to the object mode compilation path has been detected, this is deprecated behaviour.

For more information visit http://numba.pydata.org/numba-doc/latest/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit

File "<ipython-input-56-b9b01bd2fa01>", line 14:
def bellmannb(x,w0):
    <source elided>
    vals = np.array([])
    for k in x:
    ^

  warnings.warn(errors.NumbaDeprecationWarning(msg, self.func_ir.loc))
<ipython-input-56-b9b01bd2fa01>:19: NumbaWarning: 
Compilation is falling back to object mode WITHOUT looplifting enabled because Function "policynb" failed type inference due to: Untyped global name 'fminbound': cannot determine Numba type of <class &#x27;function&#x27;>

File "<ipython-input-56-b9b01bd2fa01>", line 31:
def policynb(x,w0):
    <source elided>
        kmax = F_nb(k,alpha,A)
        vals = np.append(vals,fminbound(Utrf, 0, kmax, args=[kmax,k,sigma,w]))
        ^

  @nb.jit('f8[:](f8[:],f8[:])')
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:742: NumbaWarning: Function "policynb" was compiled in object mode without forceobj=True.

File "<ipython-input-56-b9b01bd2fa01>", line 29:
def policynb(x,w0):
    <source elided>
    vals = np.array([])
    for k in x:
    ^

  self.func_ir.loc))
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:751: NumbaDeprecationWarning: 
Fall-back from the nopython compilation path to the object mode compilation path has been detected, this is deprecated behaviour.

For more information visit http://numba.pydata.org/numba-doc/latest/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit

File "<ipython-input-56-b9b01bd2fa01>", line 29:
def policynb(x,w0):
    <source elided>
    vals = np.array([])
    for k in x:
    ^

  warnings.warn(errors.NumbaDeprecationWarning(msg, self.func_ir.loc))
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [58]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> bellmannb(grid, U0)
<span class="o">%</span><span class="k">timeit</span> policynb(grid, U0)
<span class="o">%</span><span class="k">timeit</span> solvenb()
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>130 ms ± 2.09 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
127 ms ± 1.45 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><ipython-input-56-b9b01bd2fa01>:43: NumbaWarning: 
Compilation is falling back to object mode WITHOUT looplifting enabled because Function "solvenb" failed type inference due to: Invalid use of type(CPUDispatcher(<function bellmannb at 0x1b7a36950>)) with parameters (readonly array(float64, 1d, C), array(float64, 1d, C))
 * parameterized
[1] During: resolving callee type: type(CPUDispatcher(<function bellmannb at 0x1b7a36950>))
[2] During: typing of call at <ipython-input-56-b9b01bd2fa01> (48)


File "<ipython-input-56-b9b01bd2fa01>", line 48:
def solvenb():
    <source elided>
    while count<maxiter: v1="bellmannb(grid,V0)" ^ @nb.jit(&#x27;f8[:]()&#x27;) users ozak anaconda3 envs geopython36env lib python3.6 site-packages numba compiler.py:742: numbawarning: function &quot;solvenb&quot; was compiled in object mode without forceobj="True." file &quot;&lt;ipython-input-56-b9b01bd2fa01>", line 46:
def solvenb():
    <source elided>
    count=0.0
    V0=U(grid,sigma)
    ^

  self.func_ir.loc))
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:751: NumbaDeprecationWarning: 
Fall-back from the nopython compilation path to the object mode compilation path has been detected, this is deprecated behaviour.

For more information visit http://numba.pydata.org/numba-doc/latest/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit

File "<ipython-input-56-b9b01bd2fa01>", line 46:
def solvenb():
    <source elided>
    count=0.0
    V0=U(grid,sigma)
    ^

  warnings.warn(errors.NumbaDeprecationWarning(msg, self.func_ir.loc))
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>138.0
138.0
138.0
138.0
138.0
138.0
138.0
138.0
16.6 s ± 688 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [59]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">V0</span><span class="p">(</span><span class="n">grid</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">'V0'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">U0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[59]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><matplotlib.legend.legend at 0x1b7fac240></pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img src="data:image/png;base64,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
" />
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [60]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">C0</span><span class="p">(</span><span class="n">grid</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">'C0'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">c0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[60]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><matplotlib.legend.legend at 0x1b7ebb438></pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img src="data:image/png;base64,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
" />
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [61]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8(f8[:], f8[:])'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">errnb</span><span class="p">(</span><span class="n">V0</span><span class="p">,</span> <span class="n">V1</span><span class="p">):</span>
    <span class="n">maxi</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">V0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">m</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">V1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">V0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">>=</span><span class="n">maxi</span><span class="p">:</span>
            <span class="n">maxi</span><span class="o">=</span><span class="n">m</span>
    <span class="k">return</span> <span class="n">maxi</span>

<span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">'f8[:]()'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">solvenb</span><span class="p">():</span>
    <span class="n">count</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">V0</span> <span class="o">=</span> <span class="n">U</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">count</span><span class="o"><</span><span class="n">maxiter</span><span class="p">:</span>
        <span class="n">V1</span> <span class="o">=</span> <span class="n">bellmannb</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">V0</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">errnb</span><span class="p">(</span><span class="n">V1</span><span class="p">,</span> <span class="n">V0</span><span class="p">)</span>
        <span class="n">V0</span> <span class="o">=</span> <span class="n">V1</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">err</span><span class="o"><</span><span class="n">tol</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">V0</span>
<span class="o">%</span><span class="k">timeit</span> solvenb()
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><ipython-input-61-dfc6052a5170>:10: NumbaWarning: 
Compilation is falling back to object mode WITH looplifting enabled because Function "solvenb" failed type inference due to: Invalid use of type(CPUDispatcher(<function u at 0x1b7876d08>)) with parameters (readonly array(float64, 1d, C), Literal[int](1))
Known signatures:
 * (array(float64, 1d, A), float64) -> array(float64, 1d, A)
 * parameterized
[1] During: resolving callee type: type(CPUDispatcher(<function u at 0x1b7876d08>))
[2] During: typing of call at <ipython-input-61-dfc6052a5170> (13)


File "<ipython-input-61-dfc6052a5170>", line 13:
def solvenb():
    <source elided>
    count=0.0
    V0 = U(grid,sigma)
    ^

  @nb.jit('f8[:]()')
<ipython-input-61-dfc6052a5170>:10: NumbaWarning: 
Compilation is falling back to object mode WITHOUT looplifting enabled because Function "solvenb" failed type inference due to: cannot determine Numba type of <class &#x27;numba.dispatcher.liftedloop&#x27;>

File "<ipython-input-61-dfc6052a5170>", line 13:
def solvenb():
    <source elided>
    count=0.0
    V0 = U(grid,sigma)
    ^

  @nb.jit('f8[:]()')
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:742: NumbaWarning: Function "solvenb" was compiled in object mode without forceobj=True, but has lifted loops.

File "<ipython-input-61-dfc6052a5170>", line 11:
@nb.jit('f8[:]()')
def solvenb():
^

  self.func_ir.loc))
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:751: NumbaDeprecationWarning: 
Fall-back from the nopython compilation path to the object mode compilation path has been detected, this is deprecated behaviour.

For more information visit http://numba.pydata.org/numba-doc/latest/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit

File "<ipython-input-61-dfc6052a5170>", line 11:
@nb.jit('f8[:]()')
def solvenb():
^

  warnings.warn(errors.NumbaDeprecationWarning(msg, self.func_ir.loc))
<ipython-input-61-dfc6052a5170>:10: NumbaWarning: 
Compilation is falling back to object mode WITHOUT looplifting enabled because Function "solvenb" failed type inference due to: Invalid use of type(CPUDispatcher(<function bellmannb at 0x1b7a36950>)) with parameters (readonly array(float64, 1d, C), array(float64, 1d, C))
 * parameterized
[1] During: resolving callee type: type(CPUDispatcher(<function bellmannb at 0x1b7a36950>))
[2] During: typing of call at <ipython-input-61-dfc6052a5170> (15)


File "<ipython-input-61-dfc6052a5170>", line 15:
def solvenb():
    <source elided>
    while count<maxiter: v1="bellmannb(grid," v0) ^ @nb.jit(&#x27;f8[:]()&#x27;) users ozak anaconda3 envs geopython36env lib python3.6 site-packages numba compiler.py:742: numbawarning: function &quot;solvenb&quot; was compiled in object mode without forceobj="True." file &quot;&lt;ipython-input-61-dfc6052a5170>", line 13:
def solvenb():
    <source elided>
    count=0.0
    V0 = U(grid,sigma)
    ^

  self.func_ir.loc))
/Users/ozak/anaconda3/envs/GeoPython36env/lib/python3.6/site-packages/numba/compiler.py:751: NumbaDeprecationWarning: 
Fall-back from the nopython compilation path to the object mode compilation path has been detected, this is deprecated behaviour.

For more information visit http://numba.pydata.org/numba-doc/latest/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit

File "<ipython-input-61-dfc6052a5170>", line 13:
def solvenb():
    <source elided>
    count=0.0
    V0 = U(grid,sigma)
    ^

  warnings.warn(errors.NumbaDeprecationWarning(msg, self.func_ir.loc))
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>138.0
138.0
138.0
138.0
138.0
138.0
138.0
138.0
16.2 s ± 72.9 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre>
</div>
</div>
</div>
</div>
</div>

<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
        <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/econgrowth"><i class="fa fa-github-square fa-lg"></i> Github</a></li>
                <li class="list-group-item"><a href="https://twitter.com/OmerOzakEcon"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                <li class="list-group-item"><a href="https://linkedin.com/in/omerozak"><i class="fa fa-linkedin-square fa-lg"></i> Linkedin</a></li>
                <li class="list-group-item"><a href="https://www.researchgate.net/profile/Oemer_Oezak"><i class="fa fa-researchgate-square fa-lg"></i> Researchgate</a></li>
              </ul>
            </li>

    <li class="list-group-item"><h4><i class="fa fa-external-link fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://omerozak.com/" target="_blank">
                Ömer Özak
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://www.smu.edu/economics" target="_blank">
                Dept. Economics
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://www.smu.edu/" target="_blank">
                SMU
            </a>
        </li>
      </ul>
    </li>



            <li class="list-group-item"><a href="https://macroeconomics.github.io/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                    <li class="list-group-item tag-1">
                        <a href="https://macroeconomics.github.io/tag/macroeconomics.html">
                            Macroeconomics
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://macroeconomics.github.io/tag/ipython.html">
                            IPython
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://macroeconomics.github.io/tag/notebooks.html">
                            Notebooks
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://macroeconomics.github.io/tag/economic-growth.html">
                            Economic Growth
                        </a>
                    </li>
                </ul>
            </li>



    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
            <a href="https://github.com/Macroeconomics">@Macroeconomics</a> on GitHub
    </li>
    </ul>
</section>            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Ömer Özak
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                <p><small>  <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://macroeconomics.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://macroeconomics.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://macroeconomics.github.io/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'https://macroeconomics.github.io/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'Macroeconomics',
                count: 2,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="https://macroeconomics.github.io/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->

        <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-586c25633fd6ba9b"></script>
</body>
</html>